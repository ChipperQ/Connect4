# Miguel Quime
# Connect Four

# Runs the game.
class Game

# Big giant magic array, has every possible way you can win in Connect 4.
	module Pattern
		Won = 
		[[(/RRRR....................................../),:R],	[(/BBBB....................................../),:B],	[(/R......R......R......R..................../),:R],	[(/B......B......B......B..................../),:B],	[(/R.......R.......R.......R................./),:R],	[(/..B.......B.......B.......B.............../),:B],	[(/......B.....B.....B.....B................./),:B],
		[(/.RRRR...................................../), :R],	[(/.BBBB...................................../),:B],	[(/.......R......R......R......R............./),:R],	[(/.......B......B......B......B............./),:B],	[(/........R.......R.......R.......R........./),:R],	[(/..........B.......B.......B.......B......./),:B],	[(/............B.....B.....B.....B.........../),:B],
		[(/..RRRR..................................../), :R],	[(/..BBBB..................................../),:B],	[(/..............R......R......R......R....../),:R],	[(/..............B......B......B......B....../),:B],	[(/................R.......R.......R.......R./),:R],	[(/...B.......B.......B.......B............../),:B],	[(/..................B.....B.....B.....B...../),:B],
		[(/...RRRR.................................../), :R],	[(/...BBBB.................................../),:B],	[(/.R......R......R......R.................../),:R],	[(/.B......B......B......B.................../),:B],	[(/.R.......R.......R.......R................/),:R],	[(/...R.....R.....R.....R..................../),:R],	[(/.............B.....B.....B.....B........../),:B],
		[(/.......RRRR.............................../), :R],	[(/.......BBBB.............................../),:B],	[(/........R......R......R......R............/),:R],	[(/........B......B......B......B............/),:B],	[(/.........R.......R.......R.......R......../),:R],	[(/....R.....R.....R.....R.................../),:R],	[(/...................B.....B.....B.....B..../),:B],
		[(/........RRRR............................../), :R],	[(/........BBBB............................../),:B],	[(/...............R......R......R......R...../),:R],	[(/...............B......B......B......B...../),:B],	[(/.................R.......R.......R.......R/),:R],	[(/..........R.....R.....R.....R............./),:R],	[(/....................B.....B.....B.....B.../),:B],
		[(/.........RRRR............................./), :R],	[(/.........BBBB............................./),:B],	[(/..R......R......R......R................../),:R],	[(/..B......B......B......B................../),:B],	[(/..............R.......R.......R.......R.../),:R],	[(/.....R.....R.....R.....R................../),:R],
		[(/..........RRRR............................/), :R],	[(/..........BBBB............................/),:B],	[(/.........R......R......R......R.........../),:R],	[(/.........B......B......B......B.........../),:B],	[(/.......R.......R.......R.......R........../),:R],	[(/...........R.....R.....R.....R............/),:R],
		[(/..............RRRR......................../), :R],	[(/..............BBBB......................../),:B],	[(/................R......R......R......R..../),:R],	[(/................B......B......B......B..../),:B],	[(/...............R.......R.......R.......R../),:R],	[(/.................R.....R.....R.....R....../),:R],
		[(/...............RRRR......................./), :R],	[(/...............BBBB......................./),:B],	[(/...R......R......R......R................./),:R],	[(/...B......B......B......B................./),:B],	[(/..R.......R.......R.......R.............../),:R],	[(/......R.....R.....R.....R................./),:R],
		[(/................RRRR....................../), :R],	[(/................BBBB....................../),:B],	[(/..........R......R......R......R........../),:R],	[(/..........B......B......B......B........../),:B],	[(/..........R.......R.......R.......R......./),:R],	[(/............R.....R.....R.....R.........../),:R],
		[(/.................RRRR...................../), :R],	[(/.................BBBB...................../),:B],	[(/.................R......R......R......R.../),:R],	[(/.................B......B......B......B.../),:B],	[(/...R.......R.......R.......R............../),:R],	[(/..................R.....R.....R.....R...../),:R],
		[(/.....................RRRR................./), :R],	[(/.....................BBBB................./),:B],	[(/....R......R......R......R................/),:R],	[(/....B......B......B......B................/),:B],	[(/B.......B.......B.......B................./),:B],	[(/.............R.....R.....R.....R........../),:R],
		[(/......................RRRR................/), :R],	[(/......................BBBB................/),:B],	[(/...........R......R......R......R........./),:R],	[(/...........B......B......B......B........./),:B],	[(/........B.......B.......B.......B........./),:B],	[(/...................R.....R.....R.....R..../),:R],
		[(/.......................RRRR.............../), :R],	[(/.......................BBBB.............../),:B],	[(/..................R......R......R......R../),:R],	[(/..................B......B......B......B../),:B],	[(/................B.......B.......B.......B./),:B],	[(/....................R.....R.....R.....R.../),:R],
		[(/........................RRRR............../), :R],	[(/........................BBBB............../),:B],	[(/.....R......R......R......R.............../),:R],	[(/.....B......B......B......B.............../),:B],	[(/.B.......B.......B.......B................/),:B],	[(/...B.....B.....B.....B..................../),:B],
		[(/............................RRRR........../), :R],	[(/............................BBBB........../),:B],	[(/............R......R......R......R......../),:R],	[(/............B......B......B......B......../),:B],	[(/.........B.......B.......B.......B......../),:B],	[(/....B.....B.....B.....B.................../),:B],
		[(/.............................RRRR........./), :R],	[(/.............................BBBB........./),:B],	[(/...................R......R......R......R./),:R],	[(/...................B......B......B......B./),:B],	[(/.................B.......B.......B.......B/),:B],	[(/..........B.....B.....B.....B............./),:B],
		[(/..............................RRRR......../), :R],	[(/..............................BBBB......../),:B],	[(/......R......R......R......R............../),:R],	[(/......B......B......B......B............../),:B],	[(/..............B.......B.......B.......B.../),:B],	[(/.....B.....B.....B.....B................../),:B],
		[(/...............................RRRR......./), :R],	[(/...............................BBBB......./),:B],	[(/.............R......R......R......R......./),:R],	[(/.............B......B......B......B......./),:B],	[(/.......B.......B.......B.......B........../),:B],	[(/...........B.....B.....B.....B............/),:B],
		[(/...................................RRRR.../), :R],	[(/...................................BBBB.../),:B],	[(/....................R......R......R......R/),:R],	[(/....................B......B......B......B/),:B],	[(/...............B.......B.......B.......B../),:B],	[(/.................B.....B.....B.....B....../),:B],
		[(/....................................RRRR../), :R],	[(/....................................BBBB../),:B],
		[(/.....................................RRRR./), :R],	[(/.....................................BBBB./),:B],
		[(/......................................RRRR/), :R], [(/......................................BBBB/),:B],]
	end
	attr_reader :players, :board, :board_move, :current_player
	def initialize
		@players = {:player1 => 'R', :player2 => 'B'}
    @board = [].fill(0,42) {" "}
		@current_player = @players[:player1]
	end

# Places the piece at the correct spot on the board.
# 'last_row' places the piece at the bottom of the board.
# 'stack_row' Allows the pieces to stack on top each other, if the position below it is occupied. 
	def make_move(pmove)
		  @move = @pmove = pmove
			last_row = 35
      stack_row = 7
			@move += last_row
			while occupied?()
				@move -= stack_row
				break if @move < 0
			end
			if is_valid_move == true
				 @board[@move] = @current_player
			else
				puts "Invalid"
        false
			end
	end

# Checks to see if there is an 'R' or 'B', at that particular spot in the board array. 	
	def occupied?
		if @board[@move] == " "
			return false
		else
			return true
		end
	end

# Determines if the position clicked is within 0 to 7, non-inclusive. 0..7 represents the column.	
	def is_valid_move()
		if @pmove >= 0 && @pmove < 7 && occupied? == false 
			return true
		else 
			return false
		end
	end

# Switches players after every move, unless the game ends.
	def switch_player()
		if @current_player == 'R' 
			@current_player = @players[:player2]
		else 
			@current_player = @players[:player1]
		end
	end

# Checks the module Pattern to see if there is a winning pattern.
	def check_for_win()
		@winner = nil
		w = Pattern::Won.find {|p| p.first =~ @board.join}
			if w 
				@winner = (w.last === :R) ? 'R' : 'B'
				return true
			end
			false
	end
  
# If the module Pattern returns false, and all the spaces are filled, then the game ends wtih a tie.
	def game_tie?()
		if @board.include?(" ") == false
			return true
		end
	end

# The game ends if check_for_win returns true, or game_tie? returns true.
	def end_game()
		if check_for_win() then
			return true
	  end
  end
  
end
